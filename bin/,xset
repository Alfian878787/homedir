#!/bin/bash

xrdb ~/.Xresources
xmodmap ~/.Xmodmap
xset m 12/1 1
xset r rate 240 40

# Clear the root window to a neutral color.

xsetroot -solid '#839496'

# Specific settings for specific machines.  Note that we skip device
# setup if the X display is remote.

if [ "$DISPLAY" = ":0" ]
then
    if [ "$(hostname)" = "bernardus" -o "$(hostname)" = "old38" ]
    then
        DPI=130

    elif [ "$(hostname)" = "guinness" ]
    then
        DPI=96

        # Turn off touchpad taps, since they are always accidental.

        xinput --set-prop "AlpsPS/2 ALPS DualPoint TouchPad" \
	       "Synaptics Tap Action" 0 0 0 0 0 0 0

    elif [ "$(hostname)" = "odell" ]
    then
        DPI=160

    else
        DPI=96
    fi
    xrandr --dpi $DPI
    echo Xft.dpi: $DPI | xrdb -merge

    if xinput | grep -q 'TPPS/2 IBM TrackPoint'
    then
        # Ubuntu 16
        xinput set-prop 'TPPS/2 IBM TrackPoint' \
               'Evdev Wheel Emulation Axes' 7 6 5 4
        # Ubuntu 17.04
        xinput set-prop 'TPPS/2 IBM TrackPoint' \
               "libinput Natural Scrolling Enabled" 1

        p=/sys/devices/platform/i8042/serio1/serio2/sensitivity
        if [ "$(cat $p)" != 255 ]
        then echo 255 | sudo dd of=$p status=none
        fi

        p=/sys/devices/platform/i8042/serio1/serio2/speed
        if [ "$(cat $p)" != 255 ]
        then echo 255 | sudo dd of=$p status=none
        fi

        xinput set-prop 'TPPS/2 IBM TrackPoint' 'libinput Accel Speed' 0
    fi
fi
