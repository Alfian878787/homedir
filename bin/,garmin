#!/bin/bash
#
# Prepare Garmin watch GPS track for upload.

set -e

export NUMBER=${1:-1}

gvfs-mount -m -d /dev/sdb /media/$USER/GARMIN
[ -d /media/$USER/GARMIN ]  # since gvfs-mount is broken: no error code on fail
/usr/share/pytrainer/plugins/garmin-fit/bin/fit2tcx \
    < $(find /media/$USER/GARMIN/GARMIN/ACTIVITY | sort | tail "-${NUMBER}" | head -1) \
    > ~/Downloads/TMP.TCX
gvfs-mount -u /media/$USER/GARMIN

python -m webbrowser -t https://runkeeper.com/new/activity
