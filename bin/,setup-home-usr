#!/bin/bash
#
# Build a Python virtual environment in ~/usr.

set -e

SYSPY=/Library/Frameworks/Python.framework/Versions/2.7/bin/python2.7
if [ ! -x $SYSPY ]; then
    SYSPY=/usr/bin/python2.7
fi
if [ ! -x $SYSPY ]; then
    # for Webfaction
    SYSPY=/usr/local/bin/python2.7
fi

$SYSPY ~/usr/src/virtualenv/virtualenv.py --clear --unzip-setuptools \
    --system-site-packages ~/usr

. ~/usr/bin/activate

# Prevent myself from accidentally forgetting to activate a virtualenv
# and running my home directory's "pip" instead.

rm -f ~/usr/bin/pip-homedir
mv ~/usr/bin/pip ~/usr/bin/pip-homedir

# These "-U" ("update") options mean that when this script is run again
# later it will make sure that all of these packages are at their most
# recent version.  Note that we update the packaging programs themselves
# first, so that it is their latest version which is then used to
# install the subsequent packages.

pip-homedir install -U pip
pip-homedir install -U distribute

pip-homedir install -U bpython
pip-homedir install -U docutils
pip-homedir install -U mercurial
pip-homedir install -U uncommitted
